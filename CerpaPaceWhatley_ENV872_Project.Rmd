---
title: "Trends in Heating and Cooling Days in Suburban and Urban Settlements in the U.S. Southwest"
author: "Candela Cerpa & Samantha Pace & Vinny Whatley"
subtitle: "GitHub Repository: https://github.com/vinny-chasing-sunset/CerpaPaceWhatley__ENV872_EDA_FinalProject"
date: "2023-12-13"
output: pdf_document
---
\newpage
\tableofcontents 
\newpage
\listoftables 
\listoffigures 
\newpage

```{r setup, include = FALSE}
# Install and load packages
#install.packages(tidyverse)
#install.packages(lubridate)
#install.packages(here)
#install.packages(ggthemes)
#install.packagescowplot)
#install.packages(zoo)
#install.packages(knitr)
#install.packages(Kendall)

library(tidyverse)
library(lubridate)
library(here)
library(ggthemes)
library(cowplot)
library(zoo)
library(knitr)
library(Kendall)

# Set your working directory
here()
```

```{r setting global code chunks, include = FALSE}
opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE, 
               fig.height = 3, fig.width = 6)
```

```{r set ggplot theme}
# Set your ggplot theme
theme <- theme_base() +
  theme(
   plot.background = element_rect(
      color = "black",
      fill = "gray"
    ),
    legend.position = "top", 
   legend.direction = "horizontal",
    complete = TRUE
  )
theme_set(theme)

#monthly labels
month_lab = tibble(doy = yday(as.Date(c("1980-02-15", "1980-04-15",
                                          "1980-06-15", "1980-08-15",
                                          "1980-10-15", "1980-12-15"))),
                     lab = c("Feb", "Apr", "Jun", "Aug", "Oct", "Dec"))
```

# 1. Rationale and Research Questions

Climate change, long-term shifts in temperatures and weather patterns, is a naturally occurring process that has been accelerated by human actions, primarily the burning of fossil fuels. One of the impacts of climate change is rising temperatures, which have negative impacts on Earth’s ecosystems, such as melting glaciers, intensifying storms, and worsening drought conditions. Humans are directly impacted by rising temperatures: as the number of hot days and heat waves increases, so does the number of heat-related illnesses.

The U.S. has not escaped these impacts. The U.S. Southwest, which we define as Arizona, California, and Nevada, has witnessed an uptick in droughts. Lake Me, the main source of drinking water for Nevada, has seen record lows in recent years, cautioning the state to adopt water conservation strategies. News about California’s wildfire seasons seem to increase in intensity and length every year. Arizona has reported some of the highest temperatures in the U.S. Lastly, the impacts are not spread evenly across human settlements. The Urban Heat Island phenomenon describes the situation where cities, with their heat-trapping cement and lower tree canopy cover, tend to be hotter than nearby suburban areas.

In light of these issues, this project aims to understand the intensity of rising temperatures in the U.S. Southwest.  Our research questions are:

1. Has there been an increase in the number of Heating and Cooling Days in the U.S. Southwest from 1980 to 2022?

2. Is there a difference in Heating and Cooling Days in urban and suburban spaces in the U.S. Southwest over time?

3. How have minimum and maximum temperatures changed over time?

# 2. Dataset Information

We retrieved historical temperature data  from NOAA's National Centers for Environmental Information (NCEI), specifically from the GHCN (Global Historical Climatology Network). We chose this dataset because NCEI is a reputable source of weather-related historic data. We selected a total of six stations, encompassing three major cities and each with an associated nearby suburban location. We selected the nearby suburban locations to be within 50 miles of the major city and with a population of less than 50,000 in 2022. The selected locations are as follows:

* Phoenix and Fountain Hills, Arizona
* Las Vegas and Pahrump, Nevada
* San Diego and Ramona, California

We primarily examined the daily data for TMAX = Maximum temperature (Fahrenheit) and TMIN = Minimum temperature (Fahrenheit) for each of the six locations. As Table 1 shows, our datasets had varying levels of coverage and start dates for each location. All the datasets had high coverage from 1998-2022, and all but Ramona, CA have data from 1980-1998. More information about this data's documentation can be found at https://www.ncei.noaa.gov/pub/data/cdo/documentation/GHCND_documentation.pdf and in the Metadata folder of this project's repository.

```{r Load Processed files}
Phoenix <- read.csv(here("./Data/Processed/PhoenixAZ_processed.csv"),
                    stringsAsFactors = TRUE) %>% 
  mutate(Date = ymd(Date))

FountainHills <- read.csv(here("./Data/Processed/FountainHillsAZ_processed.csv"),
                          stringsAsFactors = TRUE) %>% 
  mutate(Date = ymd(Date))

LasVegas <- read.csv(here("./Data/Processed/LasVegasNV_processed.csv"),
                     stringsAsFactors = TRUE) %>% 
  mutate(Date = ymd(Date))

Pahrump <- read.csv(here("./Data/Processed/PahrumpNV_processed.csv"),
                    stringsAsFactors = TRUE) %>% 
  mutate(Date = ymd(Date))

SanDiego <- read.csv(here("./Data/Processed/SanDiegoCA_processed.csv"),
                     stringsAsFactors = TRUE) %>%
  mutate(Date = ymd(Date))

Ramona <- read.csv(here("./Data/Processed/RamonaCA_processed.csv"),
                   stringsAsFactors = TRUE) %>% 
  mutate(Date = ymd(Date))
```

```{r data structure summary table}
sum_city <- c("Phoenix", "Fountain Hills", "Las Vegas",
              "Pahrump", "San Diego", "Ramona")
sum_date <- c("1980-01-01 to 2022-12-31", "1980-01-01 to 2022-12-31",
              "1972-01-01 to 2022-12-31", "1972-01-01 to 2022-12-31",
              "1972-01-01 to 2023-01-01", "1998-04-16 to 2023-01-01")
sum_daily_temp_max <- c("43 to 122", "25 to 125", "31 to 117",
                        "27 to 115", "50 to 107", "47 to 117")
sum_daily_temp_min <- c("26 to 96", "23 to 97", "11 to 95",
                        "-2 to 86", "34 to 78", "0 to 76")
sum_temp_avg <- c("36.5 to 106.5", "33.5 to 107.5", "22 to 106",
                  "15 to 98", "43.5 to 87.5", "35 to 92")
sum_month <- c("1 to 12", "1 to 12", "1 to 12", "1 to 12", "1 to 12", "1 to 12")
sum_year <- c("1980 to 2022", "1980 to 2022", "1972 to 2022",
              "1972 to 2022", "1972 to 2023", "1998 to 2023")
sum_dayofyear <- c("1 to 366", "1 to 366", "1 to 366",
                   "1 to 366", "1 to 366", "1 to 366")
sum_heat_degrees <- c("0 to 28.5", "0 to 31.5", "0 to 43",
                      "0 to 50", "0 to 21.5", "0 to 30")
sum_cool_degrees <- c("0 to 41.5", "0 to 42.5", "0 to 41",
                      "0 to 33", "0 to 22.5", "0 to 27")

summary_table <- data.frame(sum_city, sum_date, sum_daily_temp_max,
                            sum_daily_temp_min, sum_temp_avg, sum_month, sum_year,
                            sum_dayofyear, sum_heat_degrees, sum_cool_degrees)

kable(summary_table, "pipe",
      col.names =  c("Location", "Date", "Daily Temp Max (°F)",
                     "Daily Temp Min (°F)", "Temp Avg (°F)", "Month", "Year",
                     "Day of Year", "Heating Degrees (°F)", "Cooling Degrees (°F)"),
      caption = "Data Structure Summary", align = c("c"))
```

# 3. Data Wrangling

We took several steps in our workflow to clean our datasets. The raw data included both the city and suburb in the same CSV, so we first filtered the data to separate out the locations. For each of the 6 locations, we selected the columns we were interested in exploring, which included NAME, DATE, TMAX, TMIN, TAVG, and created columns for Month, Year, and Day of Year to enable different years to be overlaid on a graph.

The Fountain Hills, Pahrump, and Ramona datasets had some missing data points in the maximum and minimum daily temperatures, so we used linear interpolation to fill in the missing data. The raw data for the 'Average Temperature' column contained many missing values, so we inputted the calculated mean of the daily maximum and minimum for this column.

## Heating and Cooling Degree Days Calculations

Having the daily average temperature calculated for each location, we then calculated the Heating Degree Days and Cooling Degree Days. Heating Degree Days are when people turn their heater on because the average temperature is low, and Cooling Degree Days is when people turn their air conditioner on because the average temperature is warm. The industry standard threshold is 65 degrees F, meaning that anything higher than 65 F would constitute a Cooling Degree Day, and anything lower than 65 would mean it is a Heating Degree Day (US EPA, 2016). The equations to calculate the Heating and Cooling Degree Days are as follows:

* If mean temperature > 65°F then: mean temperature - 65°F = Cooling Degree Days
* If mean temperature < 65°F then: 65°F - mean temperature = Heating Degree Days

From these calculations we are able to look at the number of Heating and Cooling Degree Days, as well as the intensity, which are two main components examined in the exploratory analysis section.

# 4. Exploratory Analysis 

For the purposes of exploring our data, we first plotted the three major cities together to get a sense of how their average daily temperatures compared over time, shown in Figure 1. Based on the figure, there are clear seasonal trends throughout the year, and Phoenix has the highest daily average temperature over time, followed by Las Vegas and then San Diego. The trend for Las Vegas has a noticeable positive slope over time, while the trend for Phoenix demonstrates only a slight increase and San Diego's trend remains horizontal with no major changes in slope.

```{r all cities avg temp, fig.cap = "Average Temperature for Phoenix, Las Vegas, San Diego", fig.height = 2.75}
Three_cities <- rbind(LasVegas, Phoenix, SanDiego)

ggplot(Three_cities, aes(x = Date, y = Temp_Avg, color = Location), alpha = 0.75) +
  geom_line() +
  geom_smooth(method = lm) + 
  labs(title = "Three Cities' Daily Average Temperatures",
       y = "Daily Avg Temp in degrees F", color = "Legend")
```

For the remainder of the exploratory analysis section, we focused on a single city (Phoenix, Arizona) to better understand the data for the statistical analyses. Figure 2 shows Phoenix's maximum and minimum daily temperature from 1980 until 2022. The trend for the minimum and maximum temperatures shows that there has been a modest increase in both over time. The black horizontal line in Figure 2 marks the 65 F threshold for Heating and Cooling Degrees. Based on the trends in this figure, we would expect there to be more Cooling than Heating Degree Days.

Figures 3 and 4 compare the number of Heating and Cooling Degree Days throughout the year for Phoenix in 1980 and 2022. The differences in the two figures demonstrate an increase in the number of Cooling Degree Days in March, April, and October and a decrease in the number of Heating Degree Days in February and March.

```{r plots exploring the trends in the min and max temperatures, fig.height = 2.75, fig.cap = "Phoenix Daily Maiximum and Minimum Temperatures"}
# Creating a plot with Phoenix's min and max temp
ggplot(Phoenix, aes(x = Date)) +
     	geom_line(aes(y = Daily_Temp_Max, color = "Max Temp")) +
  geom_smooth (aes(y = Daily_Temp_Max), method = lm, color = "red")+
  geom_line(aes(y = Daily_Temp_Min, color = "Min Temp")) +
  geom_smooth(aes(y = Daily_Temp_Min), method = lm, color = "blue") +
  labs( title = "Phoenix Daily Maximum and Minimum Temperatures 1980-2022",
        x = "Year", y = "Temperature in F", color = "Legend") +
  geom_hline(aes(yintercept = 65), color = "black")
```

```{r code to plot number of Heating and Cooling Days}
#Create dataframes for Heating and Cooling Days, separately
#Make one for 1980 and 2022 to compare the start and end of the time series
Phoenix_Heat_1980 <- Phoenix %>%
  group_by(Heat_Degrees) %>%
  filter(Year == "1980", Heat_Degrees != 0) %>%
  select(Date, Month, Heat_Degrees)

Phoenix_Cool_1980 <- Phoenix %>%
  group_by(Cool_Degrees) %>%
  filter(Year == "1980", Cool_Degrees != 0) %>%
  select(Date, Month, Cool_Degrees)

Phoenix_Heat_2022 <- Phoenix %>%
  group_by(Heat_Degrees) %>%
  filter(Year == "2022", Heat_Degrees != 0) %>%
  select(Date, Month, Heat_Degrees)

Phoenix_Cool_2022 <- Phoenix %>%
  group_by(Cool_Degrees) %>%
  filter(Year == "2022", Cool_Degrees != 0) %>%
  select(Date, Month, Cool_Degrees)
```

```{r number of heating/cooling days Phoenix 1980, fig.cap="Number of Phoenix's Heating and Cooling Degree Days, 1980"}
#Put the heating and Cooling days on the same graph
plot_Phoenix_1980_HeatCoolDays <- ggplot() +
  geom_bar(data = Phoenix_Cool_1980, aes(x = Month, fill = "Cooling Days")) +
  geom_bar(data = Phoenix_Heat_1980, aes(x = Month, fill = "Heating Days")) +
  scale_x_continuous(breaks = seq_along(month.abb), labels = month.abb) +
  labs(title = "Cooling and Heating Days in Phoenix, 1980", x = "Month",
       y = "Cooling or Heating Days", fill = "Legend") + 
  scale_fill_manual(values = c("blue", "red"))
print(plot_Phoenix_1980_HeatCoolDays)
```

```{r Phoenix 2022 Heating/Cooling degree days, fig.cap="Number of Phoenix's Heating and Cooling Degree Days, 2022"}
plot_Phoenix_2022_HeatCoolDays <- ggplot() +
  geom_bar(data = Phoenix_Cool_2022, aes(x = Month, fill = "Cooling Days")) +
  geom_bar(data = Phoenix_Heat_2022, aes(x = Month, fill = "Heating Days")) +
  scale_x_continuous(breaks = seq_along(month.abb), labels = month.abb) +
  labs(title = "Cooling and Heating in Phoenix, 2022", x = "Month",
       y = "Cooling or Heating Days", fill = "Legend") + 
  scale_fill_manual(values = c("blue", "red"))
print(plot_Phoenix_2022_HeatCoolDays)
```

\newpage

Figures 5 and 6 show the intensity of Heating and Cooling Degree Days in Phoenix in 1980 and 2022. In this instance, intensity is the number of degrees over or under 65 F per day. The peaks of the Heating Degree Day intensity are approximately half the intensity of the Cooling Degree Day intensity. Figure 5 shows that there were some higher peaks in 2022 of Heating Degree Days, and March of 2022 saw a much lower intensity of Heating Degree Days than March of 1980. Figure 6 shows the intensity of Cooling Degree Days peaking consistently in the month of July. July 2022 reached 39 degrees F and July 1980 reached 36 degrees F. In 2022 compared to 1980, Cooling Degree Days started earlier in the year, and consistently reached a slightly higher intensity.

```{r intensity of Heating Degree Days, fig.cap="Comparison of Heating Degree Days in Phoenix in 1980 and 2022"}
#monthly labels
month_lab = tibble(doy = yday(as.Date(c("1980-02-15", "1980-04-15",
                                          "1980-06-15", "1980-08-15",
                                          "1980-10-15", "1980-12-15"))),
                     lab = c("Feb", "Apr", "Jun", "Aug", "Oct", "Dec"))

#Heating Degree Days
Phoenix_Heat_2022 <- Phoenix %>%
  group_by(Month) %>%
  filter(Year == "2022") %>%
  select(Date, Year, Month, DayofYear, Heat_Degrees)

Phoenix_Heat_1980 <- Phoenix %>%
  group_by(Month) %>%
  filter(Year == "1980") %>%
  select(Date, Year, Month, DayofYear, Heat_Degrees)

plot_Phoenix_1980_2022_Heat <- ggplot() +
  geom_line(data = Phoenix_Heat_1980, 
            aes(x = DayofYear, y = Heat_Degrees, 
                color = '1980')) +
  geom_line(data = Phoenix_Heat_2022, 
            aes(x = DayofYear, y = Heat_Degrees, 
                color = '2022')) +
  labs(title = "Intensity of Heating Degrees (<65 F) in Phoenix (1980 & 2022)",
       x = "Month", y = "Number of Degrees F below 65 F", color = "Legend") +
  scale_x_continuous(breaks = month_lab$doy, labels = month_lab$lab) +
  ylim(0, 40)
print(plot_Phoenix_1980_2022_Heat)
```

```{r Intensity of Cooling Degree Days, fig.cap = "Comparison of Cooling Degree Days in Phoenix in 1980 and 2022"}
#Cooling Degree Days
Phoenix_Cooling_2022 <- Phoenix %>%
  group_by(Month) %>%
  filter(Year == "2022") %>%
  select(Date, Year, Month, DayofYear, Cool_Degrees)

Phoenix_Cooling_1980 <- Phoenix %>%
  group_by(Month) %>%
  filter(Year == "1980") %>%
  select(Date, Year, Month, DayofYear, Cool_Degrees)

plot_Phoenix_1980_2022_Cool <- ggplot() +
  geom_line(data = Phoenix_Cooling_1980, 
            aes(x = DayofYear, y = Cool_Degrees, 
            color='1980')) +
  geom_line(data = Phoenix_Cooling_2022, 
            aes(x = DayofYear, y = Cool_Degrees,
            color = '2022')) +
  labs(title = "Intensity of Cooling Degrees (>65 F) in Phoenix (1980 & 2022)",
       x = "Month", y = "Number of Degrees F above 65 F", color = "Legend") +
  scale_x_continuous(breaks = month_lab$doy, labels = month_lab$lab) +
  ylim(0, 40)
print(plot_Phoenix_1980_2022_Cool)
```

Comparing Figures 3 and 4 to 5 and 6 reflects the importance of understanding the intensity over quantity of Heating and Cooling Days. While the initial comparison shows a slight increase in the number of days, the intensity comparison denotes a far steeper increase. The intensity also impacts energy usage, because people usually have a buffer of temperatures at which they will turn on the heat or AC that is not just 65 degrees F. More days that are closer to 100 degrees F have a worse impact on human health and energy usage than more days that are closer to 70 degrees F. In our analysis, we thus chose to look more closely at intensity over quantity of Heating and Cooling Degree Days.

\newpage

# 5. Analysis

## Question 1: Has there been an increase in the number of Heating and Cooling Days in the U.S. Southwest from 1980 to 2022?

To address this research question, we used a time series analysis for the Heating and Cooling Degree Days for each of the three major cities. We made univariate time series objects for the Heating and Cooling Degree Days for each city, and then decomposed each time series object to separate out the seasonality, trend, and remainder from the data. The graphs below showcase the time series plots.

```{r creating time series objects for Heating and Cooling Degrees}
#Creating univariate time series objects for Heating and cooling Degrees for each major city

#Phoenix
Phoenix_heatdegrees_ts <- ts(Phoenix$Heat_Degrees, 
                            start = c(1980, 1),
                            frequency = 365)

Phoenix_cooldegrees_ts <- ts(Phoenix$Cool_Degrees, 
                            start = c(1980, 1),
                            frequency = 365)

#Las Vegas
LasVegas_heatdegrees_ts <- ts(LasVegas$Heat_Degrees,
                              start = c(1980, 1),
                              frequency = 365)

LasVegas_cooldegrees_ts <- ts(LasVegas$Cool_Degrees,
                              start = c(1980, 1),
                              frequency = 365)

#San Diego
SanDiego_heatdegrees_ts <- ts(SanDiego$Heat_Degrees,
                              start = c(1980, 1),
                              frequency = 365)

SanDiego_cooldegrees_ts <- ts(SanDiego$Cool_Degrees,
                              start = c(1980, 1),
                              frequency = 365)
```

```{r Phoenix decomposed ts for Heating Degree Days, fig.cap = "Phoenix Decomposed Time Series for Heating Degree Days"}
Phoenix_heatdegrees_ts_Decomposed <- stl(Phoenix_heatdegrees_ts,
                                         s.window = "periodic")
plot(Phoenix_heatdegrees_ts_Decomposed, main="Phoenix Heating Degree Days")
```

```{r Phoenix decomposed ts for Cooling Degree Days, fig.cap = "Phoenix Decomposed Time Series for Cooling Degree Days"}
Phoenix_cooldegrees_ts_Decomposed <- stl(Phoenix_cooldegrees_ts,
s.window = "periodic")
plot(Phoenix_cooldegrees_ts_Decomposed, main="Phoenix Cooling Degree Days")
```

```{r Las Vegas decomposed ts for Heating degrees, fig.cap = "Las Vegas Decomposed Time Series for Heating Degree Days"}
LasVegas_heatdegrees_ts_Decomposed <- stl(LasVegas_heatdegrees_ts,
s.window = "periodic")
plot(LasVegas_heatdegrees_ts_Decomposed, main="Las Vegas Heating Degree Days")
```

```{r Las Vegas decomposed ts for Cooling Degree Days, fig.cap = "Las Vegas Decomposed Time Series for Cooling Degree Days"}
LasVegas_cooldegrees_ts_Decomposed <- stl(LasVegas_cooldegrees_ts,
  s.window = "periodic")
plot(LasVegas_cooldegrees_ts_Decomposed, main = "Las Vegas Cooling Degree Days")
```

```{r San Diego decomposed ts for Heating degrees, fig.cap = "San Diego Decomposed Time Series for Heating Degree Days"}
SanDiego_heatdegrees_ts_Decomposed <- stl(SanDiego_heatdegrees_ts,
s.window = "periodic")
plot(SanDiego_heatdegrees_ts_Decomposed, main = "San Diego Heating Degree Days")
```

```{r San Diego decomposed ts for Cooling Degree Days, fig.cap = "San Diego Decomposed Time Series for Cooling Degree Days"}
SanDiego_cooldegrees_ts_Decomposed <- stl(SanDiego_cooldegrees_ts,
s.window = "periodic")
plot(SanDiego_cooldegrees_ts_Decomposed, main = "San Diego Cooling Degree Days")
```

\newpage

The Seasonal Mann-Kendall test was performed on each of the city's Heating and Cooling Degree Days data to analyze if the data is stationary. The null hypothesis for the Seasonal Mann-Kendall test is that the data is stationary, meaning there is no significant trend over time. The alternative hypothesis is that there is a significant trend in the data over time.

The results of the Seasonal Mann-Kendall test for the Heating Degree Days in Phoenix, Las Vegas, and San Diego are found in Table 2. The results indicate that Phoenix and Las Vegas have a p-value of less than 0.05 (3.0198e-13 and 2.22e-16, respectively), so the null hypothesis can be rejected. The p-value for San Diego is greater than 0.5 (having a value of 0.49529), so we cannot reject the null hypothesis. The tau value indicates the slope of the trend, and all are negative, but this is only significant for Phoenix and Las Vegas. Las Vegas has the steepest slope. 

```{r Seasonal Mann-Kendall test for Heating Degree Days, message=FALSE, warning=FALSE, include=FALSE}
#Phoenix
Phoenix_heatdegrees_trend <- SeasonalMannKendall(Phoenix_heatdegrees_ts)
Phoenix_heatdegrees_trend
# tau = -0.0592 and 2-sided p-value =3.0198e-13 (REJECT NULL)

#Las Vegas
LasVegas_heatdegrees_trend <- SeasonalMannKendall(LasVegas_heatdegrees_ts)
LasVegas_heatdegrees_trend
# tau = -0.16, 2-sided p-value =< 2.22e-16 (REJECT NULL)

#San Diego
SanDiego_heatdegrees_trend <- SeasonalMannKendall(SanDiego_heatdegrees_ts)
SanDiego_heatdegrees_trend
# tau = -0.00414, 2-sided pvalue = 0.49529 (CANNOT REJECT NULL)
```

```{r Heating Degree Days kable}
heatdegree_SMK_cities <- c("Phoenix", "Las Vegas", "San Diego")

heatdegree_SMK_p_values <- c("3.0198e-13", "2.22e-16", "0.49529")

heatdegree_SMK_tau_values <- c("-0.0592", "-0.16", "-0.00414")

heatdegree_SMK <- data.frame(heatdegree_SMK_cities, heatdegree_SMK_p_values, 
                             heatdegree_SMK_tau_values)

kable(heatdegree_SMK, "pipe", col.names =  c("City", "p-value", "tau value"), 
caption = "Results for the Seasonal Mann-Kendall test for Heating Degree Days",
align = c("l", "c", "c"), digits = 4, scientific = TRUE)
```

Table 3 shows the results of the Seasonal Mann-Kendall Test for the Cooling Degree Days over time in Phoenix, Las Vegas, and San Diego. Phoenix and Las Vegas have a p-value of less than 0.05 (p-value = 2.22e-16 for each city), so the null hypothesis can be rejected. The Heating Degree Days for Phoenix and Las Vegas have a significant trend over time. The Cooling Degree Days for San Diego produced a p-value of 0.36317, which is greater than 0.05, so we cannot reject the null hypothesis for this location. There is not a significant trend over time in the Cooling Degree Days for San Diego. For both Phoenix and Las Vegas, the slope of the trend line is positive, meaning there is a positive trend over time in Cooling Degree Days in these locations. 

```{r Seasonal Mann-Kendall test for Cooling Degree Days, message=FALSE, warning=FALSE, include=FALSE}
Phoenix_cooldegrees_trend <-SeasonalMannKendall(Phoenix_cooldegrees_ts)
Phoenix_cooldegrees_trend
#p-value =< 2.22e-16 ; reject the null hypothesis (data is stationary)
# tau = 0.0983 (slope of trend)

#Las Vegas
LasVegas_cooldegrees_trend <-SeasonalMannKendall(LasVegas_cooldegrees_ts)
LasVegas_cooldegrees_trend
# p-value is =< 2.22e-16 ; reject the null hypothesis (data is stationary) 
# tau = 0.189 (slope of the trend)

#San Diego
SanDiego_cooldegrees_trend <- SeasonalMannKendall(SanDiego_cooldegrees_ts)
SanDiego_cooldegrees_trend
# p-value is 0.36317 ; CANNOT reject the null 
# tau = -0.00542
```

```{r Cooling Degree Day kable}
cooldegree_SMK_cities <- c("Phoenix", "Las Vegas", "San Diego")

cooldegree_SMK_p_values <- c("2.22e-16", "2.22e-16", "0.36317")

cooldegree_SMK_tau_values <- c("0.0983", "0.189", "-0.00542")

cooldegree_SMK <- data.frame(cooldegree_SMK_cities, cooldegree_SMK_p_values, 
                             cooldegree_SMK_tau_values)

kable(cooldegree_SMK, "pipe", col.names =  c("City", "p-value", "tau value"), 
caption = "Results for the Seasonal Mann-Kendall test for Cooling Degree Days",
align = c("l", "c", "c"), digits = 4, scientific = TRUE)
```

In summary, we can conclude there has been a significant increase in the trend of Cooling Degree Days over time in some cities in the U.S. Southwest from 1980 to 2022, but not uniformly. There has been some significant decrease in the trend of Heating Degree Days over time in some U.S. Southwest cities from 1980 to 2022, but not in all locations. The increase in Cooling Degree Days and decrease in Heating Degree Days is evidence of the overall warming temperatures in Las Vegas and Phoenix. Tests performed on the San Diego dataset indicated that this data may be stationary, meaning there is no significant trend upward or downward in the Heating and Cooling Degree Days over time.

\newpage

## Question 2: Is there a difference in Heating and Cooling Days in urban and suburban spaces in the U.S. Southwest over time?

To address this research question, we applied ANOVA tests to find whether there was a significant difference in the means of Heating and Cooling degree days between urban and suburban spaces. In particular, we compared the Location, Year, and Location and Year as potential significant factors that contributed to the potential difference in Degree Days means. This required creating data frames for each sate to apply the test where Heating or Cooling Degree Days were the dependent variable and Location and Year as the independent variable.

```{r Summary of data for each city, include=FALSE}
summary(LasVegas)
summary(Pahrump)
summary(Phoenix)
summary(FountainHills)
summary(SanDiego)
summary(Ramona)
```

```{r Fitering each data set for companion city}
#Filtering Datasets from 1980 to 2022
LasVegasMetro <- LasVegas %>%
  filter(Year >= 1972 & Year <= 2022)

PahrumpSuburban <- Pahrump %>%
  filter(Year >= 1972 & Year <= 2022)

PhoenixMetro <- Phoenix %>%
  filter(Year >= 1980 & Year <= 2022)

FountainHillsSuburban <- FountainHills %>%
  filter(Year >= 1980 & Year <= 2022)

SanDiegoMetro <- SanDiego %>%
  filter(Year >= 1998 & Year <= 2022)

RamonaSuburban <- Ramona %>%
  filter(Year >= 1998 & Year <= 2022)
```

```{r combine nevada cities, include=FALSE}
# Combine datasets by rows
Nevada_data <- rbind(LasVegasMetro, PahrumpSuburban)

Nevada_data <- Nevada_data %>%
  select(Location, Year, Heat_Degrees, Cool_Degrees)

# Perform ANOVA test for Heat_Degrees by Location and Year
Nevada_anova_result_heat <- aov(Heat_Degrees ~ Location*Year, data = Nevada_data)

# Perform ANOVA test for Cool_Degrees by Location and Year
Nevada_anova_result_cool <- aov(Cool_Degrees ~ Location*Year, data = Nevada_data)

# Summary of ANOVA results for Heat_Degrees
summary(Nevada_anova_result_heat) 

# Summary of ANOVA results for Cool_Degrees
summary(Nevada_anova_result_cool)

# Extract F-values using the summary function
Nevada_summary_anova_heat <- summary(Nevada_anova_result_heat)
Nevada_summary_anova_cool <- summary(Nevada_anova_result_cool)
```

```{r combine Arizona cities, include=FALSE}
# Combine datasets by rows
Arizona_data <- rbind(PhoenixMetro, FountainHillsSuburban)

Arizona_data <- Arizona_data %>%
  select(Location, Year, Heat_Degrees, Cool_Degrees)

# Perform ANOVA test for Heat_Degrees by Location and Year
Arizona_anova_result_heat <- aov(Heat_Degrees ~ Location*Year,
                                 data = Arizona_data)

# Perform ANOVA test for Cool_Degrees by Location and Year
Arizona_anova_result_cool <- aov(Cool_Degrees ~ Location*Year,
                                 data = Arizona_data)

# Summary of ANOVA results for Heat_Degrees
summary(Arizona_anova_result_heat) 


# Summary of ANOVA results for Cool_Degrees
summary(Arizona_anova_result_cool)

# Extract F-values using the summary function
Arizona_summary_anova_heat <- summary(Arizona_anova_result_heat)
Arizona_summary_anova_cool <- summary(Arizona_anova_result_cool)
```

```{r combine California cities, include=FALSE}
# Combine datasets by rows
California_data <- rbind(SanDiegoMetro, RamonaSuburban)

California_data <- California_data %>%
  select(Location, Year, Heat_Degrees, Cool_Degrees)

# Perform ANOVA test for Heat_Degrees by Location and Year
California_anova_result_heat <- aov(Heat_Degrees ~ Location*Year,
                                    data = California_data)

# Perform ANOVA test for Cool_Degrees by Location and Year
California_anova_result_cool <- aov(Cool_Degrees ~ Location*Year,
                                    data = California_data)

# Summary of ANOVA results for Heat_Degrees
summary(California_anova_result_heat) 


# Summary of ANOVA results for Cool_Degrees
summary(California_anova_result_cool)

# Extract F-values using the summary function
California_summary_anova_heat <- summary(California_anova_result_heat)
California_summary_anova_cool <- summary(California_anova_result_cool)
```

Table 4 shows the results for Nevada's ANOVA test on Heating Degree Days. It shows that Location (p-value =0.0000000), Year (p-value =0.0000000), and Location:Year (p-value =0.0000000) are all statically significant in influencing the Heating Degree Days. Table 5 shows the results for Nevada's ANOVA test on Cooling Degree Days, which also shows that Location (p-value =0.0000000), Year (p-value =0.0000000), and Location:Year (p-value =0.0000000) are all statically significant in influencing the Cooling Degree Days.

```{r Nevada Kable}
# Extract the aov table from the summary.aov object
Nevada_anova_table_heat <- summary(Nevada_anova_result_heat)[[1]]

# Convert the ANOVA table to a data frame
Nevada_anova_df_heat <- as.data.frame(Nevada_anova_table_heat)

# Display the ANOVA table using kable
kable(Nevada_anova_df_heat,
      caption = "ANOVA Summary Table for Nevada Heating Degrees")

# Extract the aov table from the summary.aov object
Nevada_anova_table_cool <- summary(Nevada_anova_result_cool)[[1]]

# Convert the ANOVA table to a data frame
Nevada_anova_df_cool <- as.data.frame(Nevada_anova_table_cool)

# Display the ANOVA table using kable
kable(Nevada_anova_df_cool,
      caption = "ANOVA Summary Table for Nevada Cooling Degrees")
```

Table 6 shows the results for Arizona's ANOVA test on Heating Degree Days. It shows that Location (p-value =0.0000000) and Year (p-value = 0.0000000) are both statically significant in influencing the Heating Degree Days, but Location:Year is not statistically-significant(p-value = 0.0543096). Table 7 shows the results for Arizona's ANOVA test on Cooling Degree Days, which also shows that Location (p-value =0.0000000), Year (p-value = 0.0000005), and Location:Year (p-value = 0.0093086) are all statically significant in influencing the Cooling Degree Days.

```{r Arizona Kable}
# Extract the aov table from the summary.aov object
Arizona_anova_table_heat <- summary(Arizona_anova_result_heat)[[1]]

# Convert the ANOVA table to a data frame
Arizona_anova_df_heat <- as.data.frame(Arizona_anova_table_heat)

# Display the ANOVA table using kable
kable(Arizona_anova_df_heat,
      caption = "ANOVA Summary Table for Arizona Heating Degrees")

# Extract the aov table from the summary.aov object
Arizona_anova_table_cool <- summary(Arizona_anova_result_cool)[[1]]

# Convert the ANOVA table to a data frame
Arizona_anova_df_cool <- as.data.frame(Arizona_anova_table_cool)

# Display the ANOVA table using kable
kable(Arizona_anova_df_cool,
      caption = "ANOVA Summary Table for Arizona Cooling Degrees")
```

Table 8 shows the results for California's ANOVA test on Heating Degree Days. It shows that Location (p-value =0.0000000) and Year (p-value =0.0000000) are both statically significant in influencing the Heating Degree Days, but Location:Year is not statistically-significant(p-value = 0.65). Table 9 shows the results for California's ANOVA test on Cooling Degree Days, which also shows that Location (p-value = 0.0000139), Year (p-value =0.0000000), and Location:Year (p-value = 0.0070792) are all statically significant in influencing the Cooling Degree Days.

```{r California Kable}
# Extract the aov table from the summary.aov object
California_anova_table_heat <- summary(California_anova_result_heat)[[1]]

# Convert the ANOVA table to a data frame
California_anova_df_heat <- as.data.frame(California_anova_table_heat)

# Display the ANOVA table using kable
kable(California_anova_df_heat,
      caption = "ANOVA Summary Table for California Heating Degrees")

# Extract the aov table from the summary.aov object
California_anova_table_cool <- summary(California_anova_result_cool)[[1]]

# Convert the ANOVA table to a data frame
California_anova_df_cool <- as.data.frame(California_anova_table_cool)

# Display the ANOVA table using kable
kable(California_anova_df_cool,
      caption = "ANOVA Summary Table for California Cooling Degrees")
```

In summary, Location, Year, and Location:Year were a statistically-significant factor for most Heating and Cooling Degree Days variables, but not for locations.  Location and Year for Heating Degree Days in Arizona and in California were not a statistically-significant variable. These results show that there is, in fact, a difference in the Heating and Cooling Days that is driven by Location in every state. Therefore, we can assert that there is a statistically-significant difference in the Heating and Cooling Days between urban and suburban locations. This aligns with the literature on the Urban Heat Island effect.

\newpage

## Question 3: How have minimum and maximum temperatures changed over time?

To address the question of whether minimum and maximum temperatures have changed over time, we conducted a time series analysis on every location. Similarly to the analysis for Question 1, we created univariate time series objects for each measure for every site and then decomposed each time series to review the overall trend and presence of seasonality. The trend graph, the third row in every decomposition, makes it easier to see what the general trend is. The trend of Las Vegas minimum temperature, for example, has a very clear upward trend. The trends of Ramona's maximum and minimum temperatures are also clearly downward. All other trends, however, are difficult to ascertain just by looking at them, and the degree of the slope is an important value to know.

```{r time series objects for min and max temperatures}
#Creating univariate time series objects for min & max temperature for each site
#Phoenix
Phoenix_temp_min_ts <- ts(Phoenix$Daily_Temp_Min,
                            start = c(1980, 1),
                            frequency = 365)

Phoenix_temp_max_ts <- ts(Phoenix$Daily_Temp_Max, 
                            start = c(1980, 1),
                            frequency = 365)

#Fountain Hills
FountainHills_temp_min_ts <- ts(FountainHills$Daily_Temp_Min,
                            start = c(1980, 1),
                            frequency = 365)

FountainHills_temp_max_ts <- ts(FountainHills$Daily_Temp_Max, 
                            start = c(1980, 1),
                            frequency = 365)

#Las Vegas
LasVegas_temp_min_ts <- ts(LasVegas$Daily_Temp_Min,
                            start = c(1972, 1),
                            frequency = 365)

LasVegas_temp_max_ts <- ts(LasVegas$Daily_Temp_Max, 
                            start = c(1972, 1),
                            frequency = 365)

#Pahrump
Pahrump_temp_min_ts <- ts(Pahrump$Daily_Temp_Min,
                            start = c(1972, 1),
                            frequency = 365)

Pahrump_temp_max_ts <- ts(Pahrump$Daily_Temp_Max, 
                            start = c(1972, 1),
                            frequency = 365)

#San Diego
SanDiego_temp_min_ts <- ts(SanDiego$Daily_Temp_Min,
                            start = c(1972, 1),
                            frequency = 365)

SanDiego_temp_max_ts <- ts(SanDiego$Daily_Temp_Max, 
                            start = c(1972, 1),
                            frequency = 365)

#Ramona
Ramona_temp_min_ts <- ts(Ramona$Daily_Temp_Min,
                            start = c(1998, 1),
                            frequency = 365)

Ramona_temp_max_ts <- ts(Ramona$Daily_Temp_Max, 
                            start = c(1998, 1),
                            frequency = 365)
```

```{r Phoenix decomposed ts for maximum temperatures, fig.cap = "Phoenix Decomposed Time Series for Maximum Temperatures"}
Phoenix_temp_max_ts_Decomposed <- stl(Phoenix_temp_max_ts, s.window = "periodic")
plot(Phoenix_temp_max_ts_Decomposed, main = "Phoenix Maximum Temperature")
```

```{r Phoenix decomposed ts for minimum temperatures, fig.cap = "Phoenix Decomposed Time Series for Minimum Temperatures"}
Phoenix_temp_min_ts_Decomposed <- stl(Phoenix_temp_min_ts, s.window = "periodic")
plot(Phoenix_temp_min_ts_Decomposed, main = "Phoenix Minimum Temperature")
```

```{r Fountain Hills decomposed ts for maximum temperatures, fig.cap = "Fountain Hills Decomposed Time Series for Maximum Temperatures"}
FountainHills_temp_max_ts_Decomposed <- stl(FountainHills_temp_max_ts,
                                            s.window = "periodic")
plot(FountainHills_temp_max_ts_Decomposed,
     main = "Fountain Hills Maximum Temperature")
```

```{r Fountain Hills decomposed ts for minimum temperatures, fig.cap = "Fountain Hills Decomposed Time Series for Minimum Temperatures"}
FountainHills_temp_min_ts_Decomposed <- stl(FountainHills_temp_min_ts,
                                            s.window = "periodic")
plot(FountainHills_temp_min_ts_Decomposed,
     main = "Fountain Hills Minimum Temperature")
```

```{r Las Vegas decomposed ts for maximum temperatures, fig.cap = "Las Vegas Decomposed Time Series for Maximum Temperatures"}
LasVegas_temp_max_ts_Decomposed <- stl(LasVegas_temp_max_ts,
                                       s.window = "periodic")
plot(LasVegas_temp_max_ts_Decomposed, main = "Las Vegas Maximum Temperature")
```

```{r Las Vegas decomposed ts for minimum temperatures, fig.cap = "Las Vegas Decomposed Time Series for Minimum Temperatures"}
LasVegas_temp_min_ts_Decomposed <- stl(LasVegas_temp_min_ts,
                                       s.window = "periodic")
plot(LasVegas_temp_min_ts_Decomposed, main = "Las Vegas Minimum Temperature")
```

```{r Pahrump decomposed ts for maximum temperatures, fig.cap = "Pahrump Decomposed Time Series for Maximum Temperatures"}
Pahrump_temp_max_ts_Decomposed <- stl(Pahrump_temp_max_ts, s.window = "periodic")
plot(Pahrump_temp_max_ts_Decomposed, main = "Pahrump Maximum Temperature")
```
```{r Pahrump decomposed ts for minimum temperatures, fig.cap = "Pahrump Decomposed Time Series for Minimum Temperatures"}
Pahrump_temp_min_ts_Decomposed <- stl(Pahrump_temp_min_ts, s.window = "periodic")
plot(Pahrump_temp_min_ts_Decomposed, main = "Pahrump Minimum Temperature")
```

```{r San Diego decomposed ts for maximum temperatures, fig.cap = "San Diego Decomposed Time Series for Maximum Temperatures"}
SanDiego_temp_max_ts_Decomposed <- stl(SanDiego_temp_max_ts,
                                       s.window = "periodic")
plot(SanDiego_temp_max_ts_Decomposed, main = "San Diego Maximum Temperature")
```

```{r San Diego decomposed ts for minimum temperatures, fig.cap = "San Diego Decomposed Time Series for Minimum Temperatures"}
SanDiego_temp_min_ts_Decomposed <- stl(SanDiego_temp_min_ts,
                                       s.window = "periodic")
plot(SanDiego_temp_min_ts_Decomposed, main = "San Diego Minimum Temperature")
```

```{r Ramona decomposed ts for maximum temperatures, fig.cap = "Ramona Decomposed Time Series for Maximum Temperatures"}
Ramona_temp_max_ts_Decomposed <- stl(Ramona_temp_max_ts, s.window = "periodic")
plot(Ramona_temp_max_ts_Decomposed, main = "Ramona Maximum Temperature")
```

```{r Ramona decomposed ts for minimum temperatures, fig.cap = "Ramona Decomposed Time Series for Minimum Temperatures"}
Ramona_temp_min_ts_Decomposed <- stl(Ramona_temp_min_ts, s.window = "periodic")
plot(Ramona_temp_min_ts_Decomposed, main = "Ramona Minimum Temperature")
```

\newpage

To understand whether the data exhibit a statistically significant upward or downward trend over time, we conducted Seasonal Mann-Kendall tests. As a reminder, the null hypothesis is that the data is stationary and does not exhibit a statistically significant upward or downward trend over time. This would mean that the data exhibit no meaning that there is no change in the temperature minimum and maximum over time. The results of the tests, summarized in Table 10, show that all trends are statistically significant, as all p-values are smaller than 0.05, so none of the data are stationary. The tau value shows the slope of the trend line.

```{r Seasonal Mann-Kendall tests for min and max temperatures}
#Phoenix
Phoenix_temp_max_trend <- SeasonalMannKendall(Phoenix_temp_max_ts)
Phoenix_temp_min_trend <- SeasonalMannKendall(Phoenix_temp_min_ts)

#Fountain Hills
FountainHills_temp_max_trend <- SeasonalMannKendall(FountainHills_temp_max_ts)
FountainHills_temp_min_trend <- SeasonalMannKendall(FountainHills_temp_min_ts)

#Las Vegas
LasVegas_temp_max_trend <- SeasonalMannKendall(LasVegas_temp_max_ts)
LasVegas_temp_min_trend <- SeasonalMannKendall(LasVegas_temp_min_ts)

#Pahrump
Pahrump_temp_max_trend <- SeasonalMannKendall(Pahrump_temp_max_ts)
Pahrump_temp_min_trend <- SeasonalMannKendall(Pahrump_temp_min_ts)

#San Diego
SanDiego_temp_max_trend <- SeasonalMannKendall(SanDiego_temp_max_ts)
SanDiego_temp_min_trend <- SeasonalMannKendall(SanDiego_temp_min_ts)

#Ramona
Ramona_temp_max_trend <- SeasonalMannKendall(Ramona_temp_max_ts)
Ramona_temp_min_trend <- SeasonalMannKendall(Ramona_temp_min_ts)
```

Interestingly, Fountain Hill’s maximum temperatures (tau value = -0.0282), San Diego’s minimum temperatures (tau value = -0.0182), and Ramona’s maximum (tau value = -0.112) and minimum temperatures (tau value = -0.0912) have a downward trend. Every other variable has an upward trend. Furthermore, most maximum temperatures are increasing at a slower rate than the minimum temperatures. The only city where the opposite happens is Ramona, which is already set apart from the rest by being the only city where both temperature variables are decreasing, and the difference is smaller. The steepest slope is in Las Vegas' minimum temperatures (tau value = 0.29).

``` {r ktable with results from the Seasonal Mann-Kendall test}
temp_SMK_cities <- c("Phoenix", "Phoenix", "Fountain Hills", "Fountain Hills",
            "Las Vegas", "Las Vegas", "Pahrump", "Pahrump",
            "San Diego", "San Diego", "Ramona", "Ramona")

temp_SMK_variable <- c("max temperature", "min temperature", "max temperature",
                   "min temperature", "max temperature", "min temperature",
                   "max temperature", "min temperature", "max temperature",
                   "min temperature", "max temperature", "min temperature")

temp_SMK_p_values <- c("<2.22 e-16", "<2.22 e-16", " 7.66 e-07", "<2.22 e-16", 
                  "<2.22 e-16", "<2.22 e-16", "<2.22 e-16", "<2.22 e-16", 
                  "8.91 e-4", "5.10 e-4", "<2.22 e-16", "<2.22 e-16")

temp_SMK_tau_values <- c("0.0617", "0.0951", "-0.0282", "0.0979",
                    "0.0671", "0.29", "0.0482", "0.0678",
                    "0.0173",  "-0.0182",  "-0.112",  "-0.0912")

temp_SMK <- data.frame(temp_SMK_cities, temp_SMK_variable,
                       temp_SMK_p_values, temp_SMK_tau_values)

kable(temp_SMK, "pipe", col.names =  c("City", "Variable", "p-value", "tau value"), 
caption = "Results for the Seasonal Mann-Kendall test on minimum and maximum
temperatures", align = c("l", "c", "c", "c"), digits = 4, scientific = TRUE)
```

``` {r plots for min and max temperatures, include = FALSE}
#Phoenix plot
Phoenix_plot_temp <- ggplot(Phoenix, aes(x = Date)) +
  geom_line(aes(y = Daily_Temp_Max, color = "Max Temp")) + 
  geom_smooth(aes(y = Daily_Temp_Max), method = lm, color = "red") + 
  geom_line(aes(y = Daily_Temp_Min, color = "Min Temp")) + 
  geom_smooth(aes(y = Daily_Temp_Min), method = lm, color = "blue") + 
  scale_color_manual(values = c("pink", "lightblue")) +
  labs(title = "Phoenix (1980-2022)", x = "Year",
       y = "Daily Temp Peaks (°F)", color = "Legend")
print(Phoenix_plot_temp)

#Fountain Hills plot
FountainHills_plot_temp <- ggplot(FountainHills, aes(x = Date)) +
  geom_line(aes(y = Daily_Temp_Max, color = "Max Temp")) + 
  geom_smooth(aes(y = Daily_Temp_Max), method = lm, color = "red") + 
  geom_line(aes(y = Daily_Temp_Min, color = "Min Temp")) + 
  geom_smooth(aes(y = Daily_Temp_Min), method = lm, color = "blue") + 
  scale_color_manual(values = c("pink", "lightblue")) +
  labs(title = "Fountain Hills (1980-2022)", x = "Year",
       y = "Daily Temp Peaks (°F)", color = "Legend")
print(FountainHills_plot_temp)

#Las Vegas
LasVegas_plot_temp <- ggplot(LasVegas, aes(x = Date)) +
  geom_line(aes(y = Daily_Temp_Max, color = "Max Temp")) + 
  geom_smooth(aes(y = Daily_Temp_Max), method = lm, color = "red") + 
  geom_line(aes(y = Daily_Temp_Min, color = "Min Temp")) + 
  geom_smooth(aes(y = Daily_Temp_Min), method = lm, color = "blue") + 
  scale_color_manual(values = c("pink", "lightblue")) +
  labs(title = "Las Vegas (1972-2022)", x = "Year",
       y = "Daily Temp Peaks (°F)", color = "Legend")
print(LasVegas_plot_temp)

#Pahrump
Pahrump_plot_temp <- ggplot(Pahrump, aes(x = Date)) +
  geom_line(aes(y = Daily_Temp_Max, color = "Max Temp")) + 
  geom_smooth(aes(y = Daily_Temp_Max), method = lm, color = "red") + 
  geom_line(aes(y = Daily_Temp_Min, color = "Min Temp")) + 
  geom_smooth(aes(y = Daily_Temp_Min), method = lm, color = "blue") + 
  scale_color_manual(values = c("pink", "lightblue")) +
  labs(title = "Pahrump (1972-2022)", x = "Year",
       y = "Daily Temp Peaks (°F)", color = "Legend")
print(Pahrump_plot_temp)

#San Diego
SanDiego_plot_temp <- ggplot(SanDiego, aes(x = Date)) +
  geom_line(aes(y = Daily_Temp_Max, color = "Max Temp")) + 
  geom_smooth(aes(y = Daily_Temp_Max), method = lm, color = "red") + 
  geom_line(aes(y = Daily_Temp_Min, color = "Min Temp")) + 
  geom_smooth(aes(y = Daily_Temp_Min), method = lm, color = "blue") + 
  scale_color_manual(values = c("pink", "lightblue")) +
  labs(title = "San Diego (1972-2022)", x = "Year",
       y = "Daily Temp Peaks (°F)", color = "Legend")
print(SanDiego_plot_temp)

#Ramona
Ramona_plot_temp <- ggplot(Ramona, aes(x = Date)) +
  geom_line(aes(y = Daily_Temp_Max, color = "Max Temp")) + 
  geom_smooth(aes(y = Daily_Temp_Max), method = lm, color = "red") + 
  geom_line(aes(y = Daily_Temp_Min, color = "Min Temp")) + 
  geom_smooth(aes(y = Daily_Temp_Min), method = lm, color = "blue") + 
  scale_color_manual(values = c("pink", "lightblue")) +
  labs(title = "Ramona (1998-2022)", x = "Year",
       y = "Daily Temp Peaks (°F)", color = "Legend")
print(Ramona_plot_temp)
```

Though the trends are not linear, as shown in the decomposition graphs, Figure 23 shows show the direction of the trends in minimum and maximum temperatures across cities.

``` {r minimum and maximum temperature trends potted,  fig.cap = "Trends in Minimum and Maximum Temperatures across Cities", fig.width = 7.5, fig.height = 10}
#create a title
title <- ggdraw() +
  draw_label("Trends in Minimum and Maximum Temperatures across Cities")

#extract a legend from one of the plots, make it into an object
plot_legend <- get_legend(Ramona_plot_temp)

#add the plots without legends to a cowplot
temp_plots <- plot_grid(
  Phoenix_plot_temp + theme(legend.position = "none"),
  FountainHills_plot_temp + theme(legend.position = "none"),
  LasVegas_plot_temp + theme(legend.position = "none"),
  Pahrump_plot_temp + theme(legend.position = "none"),
  SanDiego_plot_temp + theme(legend.position = "none"),
  Ramona_plot_temp + theme(legend.position = "none"),
  align = c("hv"), ncol = 2, nrow = 3)

#combine plots and legend
temperature_plots <- plot_grid(title, plot_legend, temp_plots,
                               ncol = 1, nrow = 3, rel_heights = c(0.5, 0.5, 10))
print(temperature_plots)
```

In summary, we can conclude that there are significant changes in the trend of minimum and maximum temperatures across all cities in the U.S. Southwest, but these changes are not occurring uniformly Many of the cities, both urban and suburban, are seeing their minimums grow at a faster pace than the also-growing maximums. However, exploring why some urban and suburban cities have maximum and minimum temperatures with statistically-significant downward trend would be an important next step in research.

\newpage

# 6. Summary and Conclusions

The state of rising temperatures in the U.S. Southwest is more complex that we initially believed. For question 2, on whether there is a difference in Heating and Cooling Degree Days between urban and suburban spaces in the region, we can assert that Location represents a statistically-significant variable that influences both types of Degree Days. Our time series analyses, on the other hand, provide enough variation that we cannot conclusively provide a single answer to questions 1 and 3. On whether there is a significant trend of Cooling and Heating Days, we can say that there has been an increase in the trend of Cooling Degree Days and a decrease in the trend of Heating Degree Days, but that these are not uniform and they are not present in all cities in the U.S. Southwest. Lastly, on the question of whether minimum and maximum temperatures have changed, we can conclude that there are significant changes in the trends of these variables across all cities in the U.S. Southwest, urban and suburban, but these changes are not occurring at the same rate nor in the same direction.

The results of this project point to a need for further research and exploration about trends in and impacts of rising temperatures in the U.S. Southwest. It would be beneficial to explore what additional physical factors may be contributing to changing temperatures, such as proximity to bodies of water, and what policies differentiate the cities, such as growing urban tree canopies.

\newpage

# 7. References

US EPA, O. (2016, July 1). Climate Change Indicators: Heating and Cooling Degree Days [Reports and Assessments]. https://www.epa.gov/climate-indicators/climate-change-indicators-heating-and-cooling-degree-days
