---
title: "Trends in Heating and Cooling Days in Suburban and Urban Settlements in the U.S. Southwest"
author: "Candela Cerpa & Samantha Pace & Vinny Whatley"
date: "2023-12-13"
output: pdf_document
fig_caption: yes
---
\newpage
\tableofcontents 
\newpage
\listoftables 
\listoffigures 
\newpage

```{r setup, include=FALSE}

# Load your packages
#install.packages("ggplot2")
#install.packages("ggthemes")
#install.packages("cowplot")
#install.packages("knitr")
#install.packages("Kendall")

library(tidyverse)
library(lubridate)
library(here)
library(ggplot2)
library(ggthemes)
library(cowplot)
library(zoo)
library(knitr)
library(Kendall)

# Set your working directory
here()
```

```{r setting global code chunks, include =FALSE}
opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
```

```{r set ggplot theme}
# Set your ggplot theme
theme <- theme_base() +
  theme(
   plot.background = element_rect(
      color = "black",
      fill = "gray"
    ),
    legend.position = "top", 
   legend.direction = "horizontal",
    complete = TRUE
  )
theme_set(theme)

#monthly labels
month_lab = tibble(doy = yday(as.Date(c("1980-02-15", "1980-04-15",
                                          "1980-06-15", "1980-08-15",
                                          "1980-10-15", "1980-12-15"))),
                     lab = c("Feb", "Apr", "Jun", "Aug", "Oct", "Dec"))
```

# 1 Rationale and Research Questions
Climate change, long-term shifts in temperatures and weather patterns, is a naturally-occurring process that has been accelerated by human actions, primarily the burning of fossil fuels. One of the impacts of climate change is rising temperatures, which has negative impacts on Earth's ecosystems, such as melting glaciers, intensifying storms, and worsening drought conditions. Humans are directly impacted by rising temperatures: as the number of hot days and heat waves increase, so do the number of heat-related illnesses.

The U.S. has not escaped these impact. The southwest region of the US which we defined as Arizona, California, and Nevada has witnessed an uptick in droughts. Nevada which utilizes water from Lake Me has seen record lows in recent years cautioning them to adopt water conservation strategies while California has been no stranger to forest fires. We plan to do this by analyzing data from the National Centers for Environmental Information, using max temperature, and minimum temperature.  Thus, our research questions are:

1. Has there been an increase in the number of heating and cooling days in the U.S. Southwest from 1972 to 2022?

2. Is there a difference in heating and cooling days in urban and rural spaces in the U.S. Southwest over time?

3. How have minimum and maximum temperatures changed over time?

# 2 Dataset Information
Our datasets were retrieved from NOAA's National Centers for Environmental Information (NCEI), specifically from the GHCN (Global Historical Climatology Network). We selected a total of six stations, encompassing three major cities and each with an associated nearby suburban location. We  selected the nearby suburban locations to be within 50 miles of the major city and with a population of less than 50,000 in 2022. The selected locations are as follows:

* Phoenix and Fountain Hills, Arizona
* Las Vegas and Pahrump, Nevada
* San Diego and Ramona, California

We primarily examined the daily data for TMAX = Maximum temperature (Fahrenheit) and TMIN = Minimum temperature (Fahrenheit) for each of the six locations. Our datasets had varying levels of coverage and start dates for each location. All the datasets had high coverage from 1998-2022, and all but Ramona, CA have data from 1980-1998. More information about this data's documentation can be found at https://www.ncei.noaa.gov/pub/data/cdo/documentation/GHCND_documentation.pdf and in the Metadata folder of this project's repository.

*Describe how you wrangled your dataset in a format similar to a methods section of a journal article.*

To wrangle our data, we:
* Read in the .csv’s
* Filtered by location and created new files for each location
* Kept certain columns (name, date, precipitation, sun coverage %, max temp, min temp, average tem, total sun)
* Format the date column into a date object
* Changed the station name to the city name
* Created a column for month, year, and day of year by extracting the information from the existing date column
* Updated the column names to the full title
** Check the NAs with the summary function
* Saw that some cities have NAs in max, min, and average temperature
* Interpolate gaps in min and max using linear interpolation in Fountain Hills, Pahrump, and Ramona
* Calculate the average daily temperature and fill in the existing column
* Created separate columns for heating and cooling degrees and calculated the values
** As we created the two columns, we filled them with 0s
** We calculate heating degrees by indexing the mean temperatures that are below 65F then subtracting the mean temp from 65
** We calculate cooling degrees by indexing the mean temperatures that are above 65F then subtracting 65 from the mean temp

*Add a table that summarizes your data structure (variables, units, ranges and/or central tendencies, data source if multiple are used, etc.). This table can be made in markdown text or inserted as a kable function in an R chunk. If the latter, do not include the code used to generate your table.*

\newpage

# 3. Exploratory Analysis 

```{r Load processed files}
Phoenix <- read.csv(here("./Data/Processed/PhoenixAZ_processed.csv"),
                    stringsAsFactors = TRUE) %>% 
  mutate(Date = ymd(Date))

FountainHills <- read.csv(here("./Data/Processed/FountainHillsAZ_processed.csv"),
                          stringsAsFactors = TRUE) %>% 
  mutate(Date = ymd(Date))

LasVegas <- read.csv(here("./Data/Processed/LasVegasNV_processed.csv"),
                     stringsAsFactors = TRUE) %>% 
  mutate(Date = ymd(Date))

Pahrump <- read.csv(here("./Data/Processed/PahrumpNV_processed.csv"),
                    stringsAsFactors = TRUE) %>% 
  mutate(Date = ymd(Date))

SanDiego <- read.csv(here("./Data/Processed/SanDiegoCA_processed.csv"),
                     stringsAsFactors = TRUE) %>%
  mutate(Date = ymd(Date))

Ramona <- read.csv(here("./Data/Processed/RamonaCA_processed.csv"),
                   stringsAsFactors = TRUE) %>% 
  mutate(Date = ymd(Date))

summary(Phoenix)
summary(FountainHills)
summary(LasVegas)
summary(Pahrump)
summary(SanDiego)
summary(Ramona)
```

``` {r summary table}
sum_city <- c("Phoenix", "Fountain Hills", "Las Vegas", "Pahrump", "San Diego", "Ramona")
sum_date <- c("1980-01-01 to 2022-12-31", "1980-01-01 to 2022-12-31", "1972-01-01 to 2022-12-31", "1972-01-01 to 2022-12-31", "1972-01-01 to 2023-01-01", "1998-04-16 to 2023-01-01")
sum_precip <- c()
sum_perc_sun <- c()
sum_daily_temp_max <- c()
sum_daily_temp_min <- c()
sum_temp_avg <- c()
sum_total_sun <- c()
sum_month <- c("1 to 12", "1 to 12", "1 to 12", "1 to 12", "1 to 12", "1 to 12")
sum_year <- c("1980 to 2022", "1980 to 2022", "1972 to 2022", "1972 to 2022", "1972 to 2023", "1998 to 2023")
sum_dayofyear <- c("1 to 366", "1 to 366", "1 to 366", "1 to 366", "1 to 366", "1 to 366")
sum_heat_degrees <- c("0 to ", "0 to ", "0 to ", "0 to ", "0 to ", "0 to ")
sum_cool_degrees <- c("0 to ", "0 to ", "0 to ", "0 to ", "0 to ", "0 to ")

summary_table <- data.frame(sum_city, sum_date, sum_precip, sum_perc_sun, sum_daily_temp_max, sum_daily_temp_min, sum_temp_avg, sum_total_sun, sum_month, sum_year, sum_dayofyear, sum_heat_degrees, sum_cool_degrees)

kable(summary_table, "pipe", col.names =  c("Location", "Date", "Precipitation", "Percent_Sunshine_Possible",
    "Daily_Temp_Max", "Daily_Temp_Min", "Temp_Avg", "Total_Sunshine",
    "Month", "Year", "DayofYear"), 
caption = "Data Structure Summary", align = c("c", "c", "c", "c", "c", "c", "c", "c", "c", "c", "c", "c", "c"))
```

```{r plots exploring the trends in the min and max temperatures}
ggplot(Phoenix,
       aes(x = Date, y = Daily_Temp_Min)) +
         geom_line() + 
  geom_smooth (method = lm)+
  labs( title = "Phoenix Daily Maximum Temperatures 1980-2022")+
  geom_hline(yintercept = 65)

Three_cities <- rbind(LasVegas,
                      Phoenix,
                      SanDiego)

ggplot(Three_cities, aes(x = Date, y = Daily_Temp_Max,
                         color = Location, alpha = 0.75)) +
  geom_line() +
  geom_smooth(method=lm)
```

```{r plot number of heating and cooling days}
#Create dataframes for heating and cooling days, separately
#Make one for 1980 and 2022 to compare the start and end of the time series
Phoenix_Heat_1980 <- Phoenix %>%
  group_by(Heat_Degrees) %>%
  filter(Year == "1980", Heat_Degrees != 0) %>%
  select(Date, Month, Heat_Degrees)

Phoenix_Cool_1980 <- Phoenix %>%
  group_by(Cool_Degrees) %>%
  filter(Year == "1980", Cool_Degrees != 0) %>%
  select(Date, Month, Cool_Degrees)

Phoenix_Heat_2022 <- Phoenix %>%
  group_by(Heat_Degrees) %>%
  filter(Year == "2022", Heat_Degrees != 0) %>%
  select(Date, Month, Heat_Degrees)

Phoenix_Cool_2022 <- Phoenix %>%
  group_by(Cool_Degrees) %>%
  filter(Year == "2022", Cool_Degrees != 0) %>%
  select(Date, Month, Cool_Degrees)

#Plot heating days and cooling days in separate graph bars
plot_Phoenix_1980_Heat <- ggplot(Phoenix_Heat_1980, aes(x = Month)) +
  geom_bar(fill = "red") +
  scale_x_continuous(breaks = seq_along(month.abb), labels = month.abb) +
  labs(title = "Heating Days in Phoenix, 1980", x = "Month", y = "Heating Days")
print(plot_Phoenix_1980_Heat)

plot_Phoenix_1980_Cool <- ggplot(Phoenix_Cool_1980, aes(x = Month)) +
  geom_bar(fill = "blue") +
  scale_x_continuous(breaks = seq_along(month.abb), labels = month.abb) +
  labs(title = "Cooling Days in Phoenix, 1980", x = "Month", y = "Cooling Days")

grid_Phoenix_1980_HeatCoolDays <- plot_grid(
  plot_Phoenix_1980_Cool, plot_Phoenix_1980_Heat)
print(grid_Phoenix_1980_HeatCoolDays)

#2022 plots
plot_Phoenix_2022_Heat <- ggplot(Phoenix_Heat_2022, aes(x = Month)) +
  geom_bar(fill = "red") +
  scale_x_continuous(breaks = seq_along(month.abb), labels = month.abb) +
  labs(title = "Heating Days in Phoenix, 2022", x = "Month", y = "Heating Days")
print(plot_Phoenix_2022_Heat)

plot_Phoenix_2022_Cool <- ggplot(Phoenix_Cool_2022, aes(x = Month)) +
  geom_bar(fill = "blue") +
  scale_x_continuous(breaks = seq_along(month.abb), labels = month.abb) +
  labs(title = "Cooling Days in Phoenix, 2022", x = "Month", y = "Cooling Days")

grid_Phoenix_2022_HeatCoolDays <- plot_grid(
  plot_Phoenix_2022_Cool, plot_Phoenix_2022_Heat)
print(grid_Phoenix_2022_HeatCoolDays)

#Put the heating and cool days on the same graph
plot_Phoenix_1980_HeatCoolDays <- ggplot() +
  geom_bar(data = Phoenix_Cool_1980, aes(x = Month, fill = "Cooling Days")) +
  geom_bar(data = Phoenix_Heat_1980, aes(x = Month, fill = "Heating Days")) +
  scale_x_continuous(breaks = seq_along(month.abb), labels = month.abb) +
  labs(title = "Cooling and Heating Days in Phoenix, 1980", x = "Month",
       y = "Cooling or Heating Days") + 
  scale_fill_manual(values = c("blue", "red"))
print(plot_Phoenix_1980_HeatCoolDays)

plot_Phoenix_2022_HeatCoolDays <- ggplot() +
  geom_bar(data = Phoenix_Cool_2022, aes(x = Month, fill = "Cooling Days")) +
  geom_bar(data = Phoenix_Heat_2022, aes(x = Month, fill = "Heating Days")) +
  scale_x_continuous(breaks = seq_along(month.abb), labels = month.abb) +
  labs(title = "Cooling and Heating in Phoenix, 2022", x = "Month",
       y = "Cooling or Heating Days") + 
  scale_fill_manual(values = c("blue", "red"))
print(plot_Phoenix_2022_HeatCoolDays)
```

```{r plots for intensity of cooling and heating degree days}
#heating degree days
Phoenix_Heat_2022 <- Phoenix %>%
  group_by(Month) %>%
  filter(Year == "2022") %>%
  select(Date, Year, Month, DayofYear, Heat_Degrees)

Phoenix_Heat_1980 <- Phoenix %>%
  group_by(Month) %>%
  filter(Year == "1980") %>%
  select(Date, Year, Month, DayofYear, Heat_Degrees)

plot_Phoenix_1980_2022_Heat <- ggplot() +
  geom_line(data = Phoenix_Heat_1980, 
            aes(x = DayofYear, y = Heat_Degrees, color = Year)) +
  geom_line(data = Phoenix_Heat_2022, 
            aes(x = DayofYear, y = Heat_Degrees, color = Year)) +
  labs(title = "Intensity of Heating Degrees (<65 F) in Phoenix (1980 & 2022)",
       x = "Month", y = "Number of Degrees F below 65 F") +
  scale_x_continuous(breaks = month_lab$doy, labels = month_lab$lab) +
  ylim(0, 40)
print(plot_Phoenix_1980_2022_Heat)

Phoenix_Heat_1980_Lineplot <-
  ggplot(Phoenix_Heat_1980, aes(x = DayofYear, y = Heat_Degrees)) +
  geom_line(color = "darkorange") +
  labs(title = "Intensity of Heating Days (<65 F) in Phoenix (1980)",
       x = "Month", y = "Number of Degrees F below 65 F") +
  scale_x_continuous(breaks = month_lab$doy, labels = month_lab$lab) +
  ylim(0, 40)
print(Phoenix_Heat_1980_Lineplot)

Phoenix_Heat_2022_Lineplot <- 
  ggplot(Phoenix_Heat_2022, 
         aes(x = DayofYear, y = Heat_Degrees)) +
  geom_line(color = "purple")+
  labs(title = "Intensity of Heating Days (<65 F) in Phoenix (2022)",
       x = "Month", y = "Number of Degrees F below 65 F") +
  scale_x_continuous(breaks = month_lab$doy, labels = month_lab$lab) +
  ylim(0, 40)
print(Phoenix_Heat_2022_Lineplot)

grid_Phoenix_1980_2022_heat <-
  plot_grid(Phoenix_Heat_1980_Lineplot, Phoenix_Heat_2022_Lineplot)
print(grid_Phoenix_1980_2022_heat)

#cooling degree days
Phoenix_Cooling_2022 <- Phoenix %>%
  group_by(Month) %>%
  filter(Year == "2022") %>%
  select(Date, Year, Month, DayofYear, Cool_Degrees)

Phoenix_Cooling_1980 <- Phoenix %>%
  group_by(Month) %>%
  filter(Year == "1980") %>%
  select(Date, Year, Month, DayofYear, Cool_Degrees)

plot_Phoenix_1980_2022_Cool <- ggplot() +
  geom_line(data = Phoenix_Cooling_1980, 
            aes(x = DayofYear, y = Cool_Degrees), 
            color='darkorange') +
  geom_line(data = Phoenix_Cooling_2022, 
            aes(x = DayofYear, y = Cool_Degrees),
            color = 'purple') +
  labs(title = "Intensity of Cooling Degrees (>65 F) in Phoenix (1980-2022)",
       x = "Month", y = "Number of Degrees F above 65 F") +
  scale_x_continuous(breaks = month_lab$doy, labels = month_lab$lab) +
  ylim(0, 40)
print(plot_Phoenix_1980_2022_Cool)

Phoenix_Cool_1980_Lineplot <- 
  ggplot(Phoenix_Cooling_1980, 
         aes(x = DayofYear, y = Cool_Degrees)) +
  geom_line(color = "darkorange")+
  labs(title = "Intensity of Cooling Days (>65 F) in Phoenix (1980)",
       x = "Month", y = "Number of Degrees F Above 65 F") +
  scale_x_continuous(breaks = month_lab$doy, labels = month_lab$lab) +
  ylim(0, 40)
print(Phoenix_Cool_1980_Lineplot)

Phoenix_Cool_2022_Lineplot <- 
  ggplot(Phoenix_Cooling_2022, 
         aes(x = DayofYear, y = Cool_Degrees)) +
  geom_line(color = "purple")+
  labs(title = "Intensity of Cooling Days (>65 F) in Phoenix, 2022",
       x = "Month", y = "Number of Degrees F Above 65 F") +
  scale_x_continuous(breaks = month_lab$doy, labels = month_lab$lab) +
  ylim(0, 40)
print(Phoenix_Cool_2022_Lineplot)

grid_Phoenix_1980_2022_Cool <-
  plot_grid(Phoenix_Cool_1980_Lineplot, Phoenix_Cool_2022_Lineplot)

print(grid_Phoenix_1980_2022_Cool)
```

\newpage

# 4. Analysis

## Question 1: Has there been an increase in the number of heating and cooling days in the U.S. Southwest from 1972 to 2022?

## Question 2: Is there a difference in heating and cooling days in urban and rural spaces in the U.S. Southwest over time?

## Question 3: How have minimum and maximum temperatures changed over time?
To address the question of whether minimum and maximum temperatures have changed over time, we conducted a time series analysis on every city. We first created univariate time series objects for each measure for each site. We then decomposed each time series to review the trends and seasonality present.
```{r time series objects for min and max temperatures}
#Creating univariate time series objects for min & max temperature for each site
#Pheonix
Phoenix_temp_min_ts <- ts(Phoenix$Daily_Temp_Min,
                            start = c(1980, 1),
                            frequency = 365)

Phoenix_temp_max_ts <- ts(Phoenix$Daily_Temp_Max, 
                            start = c(1980, 1),
                            frequency = 365)

#Fountain Hills
FountainHills_temp_min_ts <- ts(FountainHills$Daily_Temp_Min,
                            start = c(1980, 1),
                            frequency = 365)

FountainHills_temp_max_ts <- ts(FountainHills$Daily_Temp_Max, 
                            start = c(1980, 1),
                            frequency = 365)

#Las Vegas
LasVegas_temp_min_ts <- ts(LasVegas$Daily_Temp_Min,
                            start = c(1972, 1),
                            frequency = 365)

LasVegas_temp_max_ts <- ts(LasVegas$Daily_Temp_Max, 
                            start = c(1972, 1),
                            frequency = 365)

#Pahrump
Pahrump_temp_min_ts <- ts(Pahrump$Daily_Temp_Min,
                            start = c(1972, 1),
                            frequency = 365)

Pahrump_temp_max_ts <- ts(Pahrump$Daily_Temp_Max, 
                            start = c(1972, 1),
                            frequency = 365)

#San Diego
SanDiego_temp_min_ts <- ts(SanDiego$Daily_Temp_Min,
                            start = c(1972, 1),
                            frequency = 365)

SanDiego_temp_max_ts <- ts(SanDiego$Daily_Temp_Max, 
                            start = c(1972, 1),
                            frequency = 365)

#Ramona
Ramona_temp_min_ts <- ts(Ramona$Daily_Temp_Min,
                            start = c(1998, 1),
                            frequency = 365)

Ramona_temp_max_ts <- ts(Ramona$Daily_Temp_Max, 
                            start = c(1998, 1),
                            frequency = 365)
```

```{r decomposing time series objects for min and max temperatures, out.width="50%"}
# Decompose each time series (ts) object
#Phoenix
Phoenix_temp_max_ts_Decomposed <- stl(Phoenix_temp_max_ts,
                                      s.window = "periodic")
plot(Phoenix_temp_max_ts_Decomposed, main = "Phoenix Max Temperature")

Phoenix_temp_min_ts_Decomposed <- stl(Phoenix_temp_min_ts, 
                                      s.window = "periodic")
plot(Phoenix_temp_min_ts_Decomposed, main = "Phoenix Min Temperature")

#Fountain Hills
FountainHills_temp_max_ts_Decomposed <- stl(FountainHills_temp_max_ts,
                                            s.window = "periodic")
plot(FountainHills_temp_max_ts_Decomposed, main = "Fountain Hills Max Temperature")

FountainHills_temp_min_ts_Decomposed <- stl(FountainHills_temp_min_ts,
                                            s.window = "periodic")
plot(FountainHills_temp_min_ts_Decomposed, main = "Fountain Hills Min Temperature")

#Las Vegas
LasVegas_temp_max_ts_Decomposed <- stl(LasVegas_temp_max_ts,
                                       s.window = "periodic")
plot(LasVegas_temp_max_ts_Decomposed, main = "Las Vegas Max Temperature")

LasVegas_temp_min_ts_Decomposed <- stl(LasVegas_temp_min_ts,
                                       s.window = "periodic")
plot(LasVegas_temp_min_ts_Decomposed, main = "Las Vegas Min Temperature")

#Pahrump
Pahrump_temp_max_ts_Decomposed <- stl(Pahrump_temp_max_ts,
                                      s.window = "periodic")
plot(Pahrump_temp_max_ts_Decomposed, main = "Pahrump Max Temperature")

Pahrump_temp_min_ts_Decomposed <- stl(Pahrump_temp_min_ts,
                                      s.window = "periodic")
plot(Pahrump_temp_min_ts_Decomposed, main = "Pahrump Min Temperature")

#San Diego
SanDiego_temp_max_ts_Decomposed <- stl(SanDiego_temp_max_ts,
                                       s.window = "periodic")
plot(SanDiego_temp_max_ts_Decomposed, main = "San Diego Max Temperature")

SanDiego_temp_min_ts_Decomposed <- stl(SanDiego_temp_min_ts,
                                       s.window = "periodic")
plot(SanDiego_temp_min_ts_Decomposed, main = "San Diego Min Temperature")

#Ramona
Ramona_temp_max_ts_Decomposed <- stl(Ramona_temp_max_ts,
                                     s.window = "periodic")
plot(Ramona_temp_max_ts_Decomposed, main = "Ramona Max Temperature")

Ramona_temp_min_ts_Decomposed <- stl(Ramona_temp_min_ts,
                                    s.window = "periodic")
plot(Ramona_temp_min_ts_Decomposed, main = "Ramona Min Temperature")
```

We then conducted a Seasonal Mann  Kendall test to test whether the hypothesis that the data is stationary. This would mean that the data exhibit no statistically-significant upward or downward trend over time, meaning that there is no change in the temperature minimum and maximums over time.
```{r SMK tests for min and max temperatures}
#Run Seasonal Mann Kendall Tests

#Phoenix
Phoenix_temp_max_trend <- SeasonalMannKendall(Phoenix_temp_max_ts)
Phoenix_temp_min_trend <- SeasonalMannKendall(Phoenix_temp_min_ts)

#Fountain Hills
FountainHills_temp_max_trend <- SeasonalMannKendall(FountainHills_temp_max_ts)
FountainHills_temp_min_trend <- SeasonalMannKendall(FountainHills_temp_min_ts)

#Las Vegas
LasVegas_temp_max_trend <- SeasonalMannKendall(LasVegas_temp_max_ts)
LasVegas_temp_min_trend <- SeasonalMannKendall(LasVegas_temp_min_ts)

#Pahrump
Pahrump_temp_max_trend <- SeasonalMannKendall(Pahrump_temp_max_ts)
Pahrump_temp_min_trend <- SeasonalMannKendall(Pahrump_temp_min_ts)

#San Diego
SanDiego_temp_max_trend <- SeasonalMannKendall(SanDiego_temp_max_ts)
SanDiego_temp_min_trend <- SeasonalMannKendall(SanDiego_temp_min_ts)

#Ramona
Ramona_temp_max_trend <- SeasonalMannKendall(Ramona_temp_max_ts)
Ramona_temp_min_trend <- SeasonalMannKendall(Ramona_temp_min_ts)
```
The results of the Seasonal Mann Kendall test show us that all trends are statistically significant, so none of the data are stationary. The tau value shows the slope of the trend. Interestingly, Fountain Hill's maximum temperatures, San Diego's minimum temperatures, and Ramona's maximum and minimum temperatures have a downward trend. Every other variable has an upward trend.
``` {r ktable with results from the Seasonal Mann Kendall test}
temp_SMK_cities <- c("Phoenix", "Phoenix", "Fountain Hills", "Fountain Hills",
            "Las Vegas", "Las Vegas", "Pahrump", "Pahrump",
            "San Diego", "San Diego", "Ramona", "Ramona")

temp_SMK_variable <- c("max temperature", "min temperature", "max temperature",
                   "min temperature", "max temperature", "min temperature",
                   "max temperature", "min temperature", "max temperature",
                   "min temperature", "max temperature", "min temperature")

temp_SMK_p_values <- c("<2.22 e-16", "<2.22 e-16", " 7.66 e-07", "<2.22 e-16", 
                  "<2.22 e-16", "<2.22 e-16", "<2.22 e-16", "<2.22 e-16", 
                  "8.91 e-4", "5.10 e-4", "<2.22 e-16", "<2.22 e-16")

temp_SMK_tau_values <- c("0.0617", "0.0951", "-0.0282", "0.0979",
                    "0.0671", "0.29", "0.0482", "0.0678",
                    "0.0173",  "-0.0182",  "-0.112",  "-0.0912")

temp_SMK <- data.frame(temp_SMK_cities, temp_SMK_variable,
                       temp_SMK_p_values, temp_SMK_tau_values)

kable(temp_SMK, "pipe", col.names =  c("City", "Variable", "p-value", "tau value"), 
caption = "Results for the Seasonal Mann Kendall test on minimum and maximum
temperatures", align = c("l", "c", "c", "c"), digits = 4, scientific = TRUE)
```

``` {r plots for min and max temperatures, include = FALSE}
#Phoenix plot
Phoenix_plot_temp <- ggplot(Phoenix, aes(x = Date)) +
  geom_line(aes(y = Daily_Temp_Max, color = "Max Temp")) + 
  geom_smooth(aes(y = Daily_Temp_Max), method = lm, color = "red") + 
  geom_line(aes(y = Daily_Temp_Min, color = "Min Temp")) + 
  geom_smooth(aes(y = Daily_Temp_Min), method = lm, color = "blue") + 
  scale_color_manual(values = c("pink", "lightblue")) +
  labs(title = "Phoenix (1980-2022)", x = "Year",
       y = "Daily Temp Peaks (°F)", color = "Legend")
print(Phoenix_plot_temp)

#Fountain Hills plot
FountainHills_plot_temp <- ggplot(FountainHills, aes(x = Date)) +
  geom_line(aes(y = Daily_Temp_Max, color = "Max Temp")) + 
  geom_smooth(aes(y = Daily_Temp_Max), method = lm, color = "red") + 
  geom_line(aes(y = Daily_Temp_Min, color = "Min Temp")) + 
  geom_smooth(aes(y = Daily_Temp_Min), method = lm, color = "blue") + 
  scale_color_manual(values = c("pink", "lightblue")) +
  labs(title = "Fountain Hills (1980-2022)", x = "Year",
       y = "Daily Temp Peaks (°F)", color = "Legend")
print(FountainHills_plot_temp)

#Las Vegas
LasVegas_plot_temp <- ggplot(LasVegas, aes(x = Date)) +
  geom_line(aes(y = Daily_Temp_Max, color = "Max Temp")) + 
  geom_smooth(aes(y = Daily_Temp_Max), method = lm, color = "red") + 
  geom_line(aes(y = Daily_Temp_Min, color = "Min Temp")) + 
  geom_smooth(aes(y = Daily_Temp_Min), method = lm, color = "blue") + 
  scale_color_manual(values = c("pink", "lightblue")) +
  labs(title = "Las Vegas (1972-2022)", x = "Year",
       y = "Daily Temp Peaks (°F)", color = "Legend")
print(LasVegas_plot_temp)

#Pahrump
Pahrump_plot_temp <- ggplot(Pahrump, aes(x = Date)) +
  geom_line(aes(y = Daily_Temp_Max, color = "Max Temp")) + 
  geom_smooth(aes(y = Daily_Temp_Max), method = lm, color = "red") + 
  geom_line(aes(y = Daily_Temp_Min, color = "Min Temp")) + 
  geom_smooth(aes(y = Daily_Temp_Min), method = lm, color = "blue") + 
  scale_color_manual(values = c("pink", "lightblue")) +
  labs(title = "Pahrump (1972-2022)", x = "Year",
       y = "Daily Temp Peaks (°F)", color = "Legend")
print(Pahrump_plot_temp)

#San Diego
SanDiego_plot_temp <- ggplot(SanDiego, aes(x = Date)) +
  geom_line(aes(y = Daily_Temp_Max, color = "Max Temp")) + 
  geom_smooth(aes(y = Daily_Temp_Max), method = lm, color = "red") + 
  geom_line(aes(y = Daily_Temp_Min, color = "Min Temp")) + 
  geom_smooth(aes(y = Daily_Temp_Min), method = lm, color = "blue") + 
  scale_color_manual(values = c("pink", "lightblue")) +
  labs(title = "San Diego (1972-2022)", x = "Year",
       y = "Daily Temp Peaks (°F)", color = "Legend")
print(SanDiego_plot_temp)

#Ramona
Ramona_plot_temp <- ggplot(Ramona, aes(x = Date)) +
  geom_line(aes(y = Daily_Temp_Max, color = "Max Temp")) + 
  geom_smooth(aes(y = Daily_Temp_Max), method = lm, color = "red") + 
  geom_line(aes(y = Daily_Temp_Min, color = "Min Temp")) + 
  geom_smooth(aes(y = Daily_Temp_Min), method = lm, color = "blue") + 
  scale_color_manual(values = c("pink", "lightblue")) +
  labs(title = "Ramona (1998-2022)", x = "Year",
       y = "Daily Temp Peaks (°F)", color = "Legend")
print(Ramona_plot_temp)
```

``` {r put above plots in a single grid,  fig.width = 7.5, fig.height = 10}
#create a title
title <- ggdraw() + draw_label("Trends in Minimum and Maximum Temperatures across Cities")

#extract a legend from one of the plots, make it into an object
plot_legend <- get_legend(Ramona_plot_temp)

#add the plots without legends to a cowplot
temp_plots <- plot_grid(
  Phoenix_plot_temp + theme(legend.position = "none"),
  FountainHills_plot_temp + theme(legend.position = "none"),
  LasVegas_plot_temp + theme(legend.position = "none"),
  Pahrump_plot_temp + theme(legend.position = "none"),
  SanDiego_plot_temp + theme(legend.position = "none"),
  Ramona_plot_temp + theme(legend.position = "none"),
  align = c("hv"), ncol = 2, nrow = 3)

#combine plots and legend
temperature_plots <- plot_grid(title, plot_legend, temp_plots, ncol = 1, nrow = 3, rel_heights = c(0.5, 0.5, 10))
print(temperature_plots)
```

The graphs above show the trends increasing or slightly decreasing in the case of .

\newpage

# 5. Summary and Conclusions


\newpage

# 6. References
<add references here if relevant, otherwise delete this section> 
